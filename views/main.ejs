<!DOCTYPE html>
<html>
	<head>
		<style>
		#board {
			display: none;
		}
		#message {
			display: block;
		}
		#send_message {
			display: block;
		}
		#conversation {
			border: 1.5px solid #ccc;
			border-radius: 3px;
			padding: 6px 12px;
			margin-bottom: 10px;
			overflow-y: auto;
			height: 200px;
		}

		</style>
		<script src = "/socket.io/socket.io.js"></script>
		<script src = "http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<title>Group Chat</title>
		<link rel='stylesheet' href='/stylesheets/style.css' />
		<link rel='stylesheet' href='/stylesheets/bootstrap.css' />
		<script src = "/javascripts/bootstrap.js"></script>
		<script>
		$(document).ready(function() {
			// set up the io tunnel
			io = io.connect();
			// prompt the user for their name
			var name = prompt("Please enter your name: ");
			// if the user has entered a name then emit a new event
			if(name) {
				io.emit('got_a_new_user', {name: name});
			}
			io.on('user_setup', function(data) {
				(function() {
					for(message_id in data.messages) {
						$('#conversation').append(data.messages[message_id])
						console.log('in the append')
					}
				})();
				
				// convdiv[0].scrollTop = convdiv[0].scrollHeight
				$('#board').fadeIn('slow', function() {
					var convdiv = $('#conversation')
					$('#conversation').animate({
						scrollTop: convdiv[0].scrollHeight
					}, 1000)
				});

				// add previous messages here and fade in the convo board
			})
			io.on('new_user', function(data) {
				$('#conversation').append(data.message);
			})
			$('#send_message').click(function() {
				if($('#message').val() !== "") {
					io.emit('new_message', {name: name, message: $('#message').val()})
					$('#message').val("")
				}
			})
			$(document).on('keyup', function(e) {
				if(e.keyCode === 13 && $('#message').val() !== "") {
					io.emit('new_message', {name: name, message: $('#message').val()})
					$('#message').val("")
				}
			})
			io.on('display_message', function(data) {
				$('#conversation').append(data.message);
				var convdiv = $('#conversation')
				convdiv[0].scrollTop = convdiv[0].scrollHeight
			})
		})

		</script>
	</head>
	<body>
		<div class="container">
			<div id="board">
				<div id="conversation">
				</div>
				<div>
					<input class="form-control" id='message' type='text' name='message' placeholder='Enter your message here'>
					<br>
					<button class="btn btn-primary pull-right" id='send_message'>Send</button>
				</div>
			</div>
		</div>
	</body>
</html>
